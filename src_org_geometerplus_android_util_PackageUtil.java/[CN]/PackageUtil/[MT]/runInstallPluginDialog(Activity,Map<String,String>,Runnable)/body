{
  final String plugin=pluginData.get("androidPlugin");
  if (plugin != null) {
    final ZLBooleanOption doNotInstallOption=new ZLBooleanOption("doNotInstall",plugin,false);
    if (!doNotInstallOption.getValue()) {
      final String pluginVersion=pluginData.get("androidPluginVersion");
      String message=null;
      String positiveButtonKey=null;
      String titleResourceKey=null;
      if (!PackageUtil.isPluginInstalled(activity,plugin)) {
        message=pluginData.get("androidPluginInstallMessage");
        positiveButtonKey="install";
        titleResourceKey="installTitle";
      }
 else       if (!PackageUtil.isPluginInstalled(activity,plugin,pluginVersion)) {
        message=pluginData.get("androidPluginUpdateMessage");
        positiveButtonKey="update";
        titleResourceKey="updateTitle";
      }
      if (message != null) {
        final ZLResource dialogResource=ZLResource.resource("dialog");
        final ZLResource pluginDialogResource=dialogResource.getResource("plugin");
        final ZLResource buttonResource=dialogResource.getResource("button");
        final View view=activity.getLayoutInflater().inflate(R.layout.plugin_dialog,null,false);
        ((TextView)view.findViewById(R.id.plugin_dialog_text)).setText(message);
        final CheckBox checkBox=(CheckBox)view.findViewById(R.id.plugin_dialog_checkbox);
        checkBox.setText(pluginDialogResource.getResource("dontAskAgain").getValue());
        final AlertDialog dialog=new AlertDialog.Builder(activity).setTitle(pluginDialogResource.getResource(titleResourceKey).getValue()).setView(view).setIcon(0).setPositiveButton(buttonResource.getResource(positiveButtonKey).getValue(),new DialogInterface.OnClickListener(){
          public void onClick(          DialogInterface dialog,          int which){
            PackageUtil.installFromMarket(activity,plugin);
          }
        }
).setNegativeButton(buttonResource.getResource("skip").getValue(),new DialogInterface.OnClickListener(){
          public void onClick(          DialogInterface dialog,          int which){
            doNotInstallOption.setValue(checkBox.isChecked());
            postRunnable.run();
          }
        }
).create();
        dialog.show();
        return;
      }
    }
  }
  postRunnable.run();
}
