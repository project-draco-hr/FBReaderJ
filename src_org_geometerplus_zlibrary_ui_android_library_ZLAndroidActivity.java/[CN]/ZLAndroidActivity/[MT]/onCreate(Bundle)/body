{
  super.onCreate(state);
  Thread.setDefaultUncaughtExceptionHandler(new UncaughtExceptionHandler(this));
  if (state != null) {
    myOrientation=state.getInt(REQUESTED_ORIENTATION_KEY,ActivityInfo.SCREEN_ORIENTATION_UNSPECIFIED);
    myChangeCounter=state.getInt(ORIENTATION_CHANGE_COUNTER_KEY);
  }
  requestWindowFeature(Window.FEATURE_NO_TITLE);
  setContentView(R.layout.main);
  setDefaultKeyMode(DEFAULT_KEYS_SEARCH_LOCAL);
  getLibrary().setActivity(this);
  final Intent intent=getIntent();
  String fileToOpen=null;
  if (Intent.ACTION_VIEW.equals(intent.getAction())) {
    final Uri uri=intent.getData();
    if (uri != null) {
      fileToOpen=fileNameFromUri(uri);
      final String scheme=uri.getScheme();
      if ("content".equals(scheme)) {
        final File file=new File(fileToOpen);
        if (!file.exists()) {
          fileToOpen=file.getParent();
        }
      }
    }
    intent.setData(null);
  }
  if (((ZLAndroidApplication)getApplication()).myMainWindow == null) {
    ZLApplication application=createApplication(fileToOpen);
    ((ZLAndroidApplication)getApplication()).myMainWindow=new ZLAndroidApplicationWindow(application);
    application.initWindow();
  }
 else   if (fileToOpen != null) {
    ZLApplication.Instance().openFile(new ZLPhysicalFile(new File(fileToOpen)));
  }
  ZLApplication.Instance().repaintView();
}
