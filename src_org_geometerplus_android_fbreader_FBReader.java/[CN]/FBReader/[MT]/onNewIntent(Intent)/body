{
  final Uri data=intent.getData();
  final FBReaderApp fbReader=(FBReaderApp)FBReaderApp.Instance();
  if ((intent.getFlags() & Intent.FLAG_ACTIVITY_LAUNCHED_FROM_HISTORY) != 0) {
    super.onNewIntent(intent);
  }
 else   if (Intent.ACTION_VIEW.equals(intent.getAction()) && data != null && "fbreader-action".equals(data.getScheme())) {
    fbReader.doAction(data.getEncodedSchemeSpecificPart());
  }
 else   if (Intent.ACTION_SEARCH.equals(intent.getAction())) {
    final String pattern=intent.getStringExtra(SearchManager.QUERY);
    final Runnable runnable=new Runnable(){
      public void run(){
        final TextSearchPopup popup=(TextSearchPopup)fbReader.getPopupById(TextSearchPopup.ID);
        popup.initPosition();
        fbReader.TextSearchPatternOption.setValue(pattern);
        if (fbReader.getTextView().search(pattern,true,false,false,false) != 0) {
          runOnUiThread(new Runnable(){
            public void run(){
              fbReader.showPopup(popup.getId());
            }
          }
);
        }
 else {
          runOnUiThread(new Runnable(){
            public void run(){
              UIUtil.showErrorMessage(FBReader.this,"textNotFound");
              popup.StartPosition=null;
            }
          }
);
        }
      }
    }
;
    UIUtil.wait("search",runnable,this);
  }
 else {
    super.onNewIntent(intent);
  }
}
