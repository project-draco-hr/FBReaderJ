{
  if (Intent.ACTION_SEARCH.equals(intent.getAction())) {
    final FBReaderApp fbReader=(FBReaderApp)FBReaderApp.Instance();
    final ZLTextView textView=fbReader.getTextView();
    final String pattern=intent.getStringExtra(SearchManager.QUERY);
    final Handler successHandler=new Handler(){
      public void handleMessage(      Message message){
        myTextSearchPanel.StartPosition=new ZLTextWordCursor(textView.getStartCursor());
        myTextSearchPanel.show(true);
      }
    }
;
    final Handler failureHandler=new Handler(){
      public void handleMessage(      Message message){
        UIUtil.showErrorMessage(FBReader.this,"textNotFound");
      }
    }
;
    final Runnable runnable=new Runnable(){
      public void run(){
        fbReader.TextSearchPatternOption.setValue(pattern);
        if (textView.search(pattern,true,false,false,false) != 0) {
          successHandler.sendEmptyMessage(0);
        }
 else {
          failureHandler.sendEmptyMessage(0);
        }
      }
    }
;
    UIUtil.wait("search",runnable,this);
  }
 else {
    super.onNewIntent(intent);
  }
}
