{
  super.onResume();
  SyncOperations.enableSync(this,true);
  myStartTimer=true;
  Config.Instance().runOnConnect(new Runnable(){
    public void run(){
      final int brightnessLevel=getZLibrary().ScreenBrightnessLevelOption.getValue();
      if (brightnessLevel != 0) {
        setScreenBrightness(brightnessLevel);
      }
 else {
        setScreenBrightnessAuto();
      }
      if (getZLibrary().DisableButtonLightsOption.getValue()) {
        setButtonLight(false);
      }
      getCollection().bindToService(FBReader.this,new Runnable(){
        public void run(){
          final BookModel model=myFBReaderApp.Model;
          if (model == null || model.Book == null) {
            return;
          }
          onPreferencesUpdate(myFBReaderApp.Collection.getBookById(model.Book.getId()));
        }
      }
);
    }
  }
);
  registerReceiver(myBatteryInfoReceiver,new IntentFilter(Intent.ACTION_BATTERY_CHANGED));
  IsPaused=false;
  if (OnResumeAction != null) {
    final Runnable action=OnResumeAction;
    OnResumeAction=null;
    action.run();
  }
  SetScreenOrientationAction.setOrientation(this,ZLibrary.Instance().getOrientationOption().getValue());
  if (myCancelIntent != null) {
    final Intent intent=myCancelIntent;
    myCancelIntent=null;
    getCollection().bindToService(this,new Runnable(){
      public void run(){
        runCancelAction(intent);
      }
    }
);
    return;
  }
 else   if (myOpenBookIntent != null) {
    final Intent intent=myOpenBookIntent;
    myOpenBookIntent=null;
    getCollection().bindToService(this,new Runnable(){
      public void run(){
        openBook(intent,null,true);
      }
    }
);
  }
 else   if (myFBReaderApp.Model == null && myFBReaderApp.ExternalBook != null) {
    getCollection().bindToService(this,new Runnable(){
      public void run(){
        myFBReaderApp.openBook(myFBReaderApp.ExternalBook,null,null);
      }
    }
);
  }
 else {
    myFBReaderApp.gotoStoredPosition();
  }
  PopupPanel.restoreVisibilities(myFBReaderApp);
  ApiServerImplementation.sendEvent(this,ApiListener.EVENT_READ_MODE_OPENED);
}
