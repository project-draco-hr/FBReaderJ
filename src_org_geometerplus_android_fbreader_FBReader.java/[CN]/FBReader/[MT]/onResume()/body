{
  super.onResume();
  switchWakeLock(getZLibrary().BatteryLevelToTurnScreenOffOption.getValue() < myFBReaderApp.getBatteryLevel());
  myStartTimer=true;
  final int brightnessLevel=getZLibrary().ScreenBrightnessLevelOption.getValue();
  if (brightnessLevel != 0) {
    setScreenBrightness(brightnessLevel);
  }
 else {
    setScreenBrightnessAuto();
  }
  if (getZLibrary().DisableButtonLightsOption.getValue()) {
    setButtonLight(false);
  }
  registerReceiver(myBatteryInfoReceiver,new IntentFilter(Intent.ACTION_BATTERY_CHANGED));
  PopupPanel.restoreVisibilities(myFBReaderApp);
  ApiServerImplementation.sendEvent(this,ApiListener.EVENT_READ_MODE_OPENED);
  getCollection().bindToService(this,new Runnable(){
    public void run(){
      final BookModel model=myFBReaderApp.Model;
      if (model == null || model.Book == null) {
        return;
      }
      onPreferencesUpdate(myFBReaderApp.Collection.getBookById(model.Book.getId()));
    }
  }
);
}
