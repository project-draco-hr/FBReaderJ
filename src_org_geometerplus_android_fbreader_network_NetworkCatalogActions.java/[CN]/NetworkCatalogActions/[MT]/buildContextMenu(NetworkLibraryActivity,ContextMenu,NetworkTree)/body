{
  final NetworkCatalogItem item=((NetworkCatalogTree)tree).Item;
  final NetworkURLCatalogItem urlItem=item instanceof NetworkURLCatalogItem ? (NetworkURLCatalogItem)item : null;
  menu.setHeaderTitle(tree.getName());
  boolean hasItems=false;
  final String catalogUrl=urlItem != null ? urlItem.getUrl(UrlInfo.Type.Catalog) : null;
  if (catalogUrl != null && (!(item instanceof BasketItem) || item.Link.basket().bookIds().size() > 0)) {
    addMenuItem(menu,ActionCode.OPEN_CATALOG,"openCatalog");
    hasItems=true;
  }
  if (tree instanceof NetworkCatalogRootTree) {
    if (item.getVisibility() == ZLBoolean3.B3_TRUE) {
      final NetworkAuthenticationManager mgr=item.Link.authenticationManager();
      if (mgr != null) {
        if (mgr.mayBeAuthorised(false)) {
          addMenuItem(menu,ActionCode.SIGNOUT,"signOut",mgr.currentUserName());
          if (TopupMenuActivity.isTopupSupported(item.Link)) {
            final String account=mgr.currentAccount();
            if (account != null) {
              addMenuItem(menu,ActionCode.TOPUP,"topup",account);
            }
          }
        }
 else {
          addMenuItem(menu,ActionCode.SIGNIN,"signIn");
        }
      }
    }
    INetworkLink link=item.Link;
    if (link instanceof ICustomNetworkLink) {
      addMenuItem(menu,ActionCode.CUSTOM_CATALOG_EDIT,"editCustomCatalog");
      addMenuItem(menu,ActionCode.CUSTOM_CATALOG_REMOVE,"removeCustomCatalog");
    }
  }
 else {
    if (urlItem != null && urlItem.getUrl(UrlInfo.Type.HtmlPage) != null) {
      addMenuItem(menu,ActionCode.OPEN_IN_BROWSER,"openInBrowser");
      hasItems=true;
    }
  }
  if (item.getVisibility() == ZLBoolean3.B3_UNDEFINED && !hasItems && item.Link.authenticationManager() != null) {
    addMenuItem(menu,ActionCode.SIGNIN,"signIn");
  }
}
