{
  final int position=((AdapterView.AdapterContextMenuInfo)menuInfo).position;
  final FileItem fileItem=getItem(position);
  if (fileItem.getBook() != null) {
    Book book=fileItem.getBook();
    ZLResource resource=ZLResource.resource("libraryView");
    menu.setHeaderTitle(fileItem.getName());
    menu.add(0,FileManager.OPEN_BOOK_ITEM_ID,0,resource.getResource("openBook").getValue());
    if (FileManager.LibraryInstance.hasState(Library.STATE_FULLY_INITIALIZED)) {
      Log.v(FileManager.LOG,"FileManager.LibraryInstance.hasState(Library.STATE_FULLY_INITIALIZED)");
    }
    try {
      if (FileManager.LibraryInstance.isBookInFavorites(book)) {
        menu.add(0,FileManager.REMOVE_FROM_FAVORITES_ITEM_ID,0,resource.getResource("removeFromFavorites").getValue());
      }
 else {
        menu.add(0,FileManager.ADD_TO_FAVORITES_ITEM_ID,0,resource.getResource("addToFavorites").getValue());
      }
      if ((FileManager.LibraryInstance.getRemoveBookMode(book) & Library.REMOVE_FROM_DISK) != 0) {
        menu.add(0,FileManager.DELETE_BOOK_ITEM_ID,0,resource.getResource("deleteBook").getValue());
      }
    }
 catch (    Exception e) {
      Log.v(FileManager.LOG,"FileManager.LibraryInstance.isBookInFavorites(book) = exception");
    }
  }
}
