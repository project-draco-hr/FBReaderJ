{
  final Spanned htmlText=Html.fromHtml(text);
  if (htmlText.getSpans(0,htmlText.length(),URLSpan.class).length == 0) {
    return htmlText;
  }
  final Spannable newHtmlText=Spannable.Factory.getInstance().newSpannable(htmlText);
  for (  URLSpan span : newHtmlText.getSpans(0,newHtmlText.length(),URLSpan.class)) {
    final int start=newHtmlText.getSpanStart(span);
    final int end=newHtmlText.getSpanEnd(span);
    final int flags=newHtmlText.getSpanFlags(span);
    final String url=NetworkLibrary.Instance().rewriteUrl(span.getURL(),true);
    newHtmlText.removeSpan(span);
    newHtmlText.setSpan(new URLSpan(url),start,end,flags);
  }
  return newHtmlText;
}
