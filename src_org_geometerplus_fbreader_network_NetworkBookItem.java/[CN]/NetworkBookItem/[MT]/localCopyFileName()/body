{
  final boolean hasBuyReference=this.reference(BookReference.Type.BUY) != null || this.reference(BookReference.Type.BUY_IN_BROWSER) != null;
  BookReference reference=null;
  String fileName=null;
  for (  BookReference ref : myReferences) {
    final int type=ref.ReferenceType;
    if ((type == BookReference.Type.DOWNLOAD_FULL || type == BookReference.Type.DOWNLOAD_FULL_CONDITIONAL || (!hasBuyReference && type == BookReference.Type.DOWNLOAD_FULL_OR_DEMO)) && (reference == null || ref.BookFormat > reference.BookFormat)) {
      String name=ref.localCopyFileName();
      if (name != null) {
        reference=ref;
        fileName=name;
      }
    }
  }
  return fileName;
}
