{
  final NetworkBookTree bookTree=(NetworkBookTree)tree;
  final NetworkBookItem book=bookTree.Book;
  if (useFullReferences(book)) {
    BookReference reference=book.reference(BookReference.Type.DOWNLOAD_FULL);
    if (reference == null || !NetworkLibraryActivity.Instance.isBeingDownloaded(reference.URL)) {
      if (book.localCopyFileName() != null) {
        return READ_BOOK_ITEM_ID;
      }
 else       if (reference != null) {
        return DOWNLOAD_BOOK_ITEM_ID;
      }
    }
  }
  return TREE_SHOW_CONTEXT_MENU;
}
