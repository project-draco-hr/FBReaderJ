{
  LinkedHashSet<Action> actions=new LinkedHashSet<Action>();
  if (useFullReferences(book)) {
    BookReference reference=book.reference(BookReference.Type.DOWNLOAD_FULL);
    if (reference != null && connection != null && connection.isBeingDownloaded(reference.URL)) {
      actions.add(new Action(TREE_NO_ACTION,"alreadyDownloading"));
    }
 else     if (book.localCopyFileName() != null) {
      actions.add(new Action(READ_BOOK_ITEM_ID,"read"));
      actions.add(new Action(DELETE_BOOK_ITEM_ID,"delete"));
    }
 else     if (reference != null) {
      actions.add(new Action(DOWNLOAD_BOOK_ITEM_ID,"download"));
    }
  }
  if (useDemoReferences(book)) {
    BookReference reference=book.reference(BookReference.Type.DOWNLOAD_DEMO);
    if (connection != null && connection.isBeingDownloaded(reference.URL)) {
      actions.add(new Action(TREE_NO_ACTION,"alreadyDownloadingDemo"));
    }
 else     if (reference.localCopyFileName(BookReference.Type.DOWNLOAD_DEMO) != null) {
      actions.add(new Action(READ_DEMO_ITEM_ID,"readDemo"));
      actions.add(new Action(DELETE_DEMO_ITEM_ID,"deleteDemo"));
    }
 else {
      actions.add(new Action(DOWNLOAD_DEMO_ITEM_ID,"downloadDemo"));
    }
  }
  if (useBuyReferences(book)) {
    int id=TREE_NO_ACTION;
    BookReference reference=null;
    if (book.reference(BookReference.Type.BUY) != null) {
      reference=book.reference(BookReference.Type.BUY);
      id=BUY_DIRECTLY_ITEM_ID;
    }
 else     if (book.reference(BookReference.Type.BUY_IN_BROWSER) != null) {
      reference=book.reference(BookReference.Type.BUY_IN_BROWSER);
      id=BUY_IN_BROWSER_ITEM_ID;
    }
    if (reference != null) {
      final String price=((BuyBookReference)reference).Price;
      actions.add(new Action(id,"buy",price));
    }
    final Basket basket=book.Link.basket();
    if (basket != null) {
      if (basket.contains(book)) {
        actions.add(new Action(REMOVE_BOOK_FROM_BASKET,"removeFromBasket"));
      }
 else {
        actions.add(new Action(ADD_BOOK_TO_BASKET,"addToBasket"));
      }
    }
  }
  return actions;
}
