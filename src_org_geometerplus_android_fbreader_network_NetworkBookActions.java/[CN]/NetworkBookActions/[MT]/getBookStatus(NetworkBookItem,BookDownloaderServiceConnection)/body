{
  if (useFullReferences(book)) {
    BookReference reference=book.reference(BookReference.Type.DOWNLOAD_FULL);
    if (reference != null && connection != null && connection.isBeingDownloaded(reference.URL)) {
      return R.drawable.ic_list_download;
    }
 else     if (book.localCopyFileName() != null) {
      return R.drawable.ic_list_flag;
    }
 else     if (reference != null) {
      return R.drawable.ic_list_download;
    }
  }
  if (useBuyReferences(book) && book.reference(BookReference.Type.BUY) != null || book.reference(BookReference.Type.BUY_IN_BROWSER) != null) {
    return R.drawable.ic_list_buy;
  }
  return 0;
}
