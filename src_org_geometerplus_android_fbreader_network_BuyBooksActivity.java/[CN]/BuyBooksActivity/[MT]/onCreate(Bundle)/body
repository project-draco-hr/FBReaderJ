{
  super.onCreate(bundle);
  Thread.setDefaultUncaughtExceptionHandler(new org.geometerplus.zlibrary.ui.android.library.UncaughtExceptionHandler(this));
  setContentView(R.layout.buy_book);
  myLibrary=NetworkLibrary.Instance();
  final List<NetworkTree.Key> keys=(List<NetworkTree.Key>)getIntent().getSerializableExtra(NetworkLibraryActivity.TREE_KEY_KEY);
  if (keys == null || keys.isEmpty()) {
    finish();
    return;
  }
  myBooks=new ArrayList<NetworkBookItem>(keys.size());
  for (  NetworkTree.Key k : keys) {
    final NetworkTree tree=myLibrary.getTreeByKey(k);
    if (tree instanceof NetworkBookTree) {
      myBooks.add(((NetworkBookTree)tree).Book);
    }
 else {
      finish();
      return;
    }
  }
  myCost=Money.ZERO;
  for (  NetworkBookItem b : myBooks) {
    if (b.getStatus() != NetworkBookItem.Status.CanBePurchased) {
      continue;
    }
    final BookBuyUrlInfo info=b.buyInfo();
    if (info == null || info.Price == null) {
      finish();
      return;
    }
    myCost=myCost.add(info.Price);
  }
  myLink=myBooks.get(0).Link;
  final NetworkAuthenticationManager mgr=myLink.authenticationManager();
  if (mgr == null) {
    finish();
    return;
  }
  myAccount=mgr.currentAccount();
  setupUI();
}
