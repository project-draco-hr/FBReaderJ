{
  final ZLResource dialogResource=ZLResource.resource("dialog");
  final ZLResource buttonResource=dialogResource.getResource("button");
  final TextView textArea=(TextView)findViewById(R.id.buy_book_text);
  final Button okButton=(Button)findViewById(R.id.buy_book_buttons).findViewById(R.id.ok_button);
  final Button cancelButton=(Button)findViewById(R.id.buy_book_buttons).findViewById(R.id.cancel_button);
  final ZLResource resource=ZLResource.resource("buyBook");
  if (myBooks.size() > 1) {
    setTitle(resource.getResource("titleSeveralBooks").getValue());
  }
 else {
    setTitle(resource.getResource("title").getValue());
  }
  if (!authorized) {
    textArea.setText(resource.getResource("notAuthorized").getValue());
    okButton.setText(buttonResource.getResource("authorize").getValue());
    cancelButton.setText(buttonResource.getResource("cancel").getValue());
    okButton.setOnClickListener(new View.OnClickListener(){
      public void onClick(      View v){
        AccountMenuActivity.runMenu(BuyBooksActivity.this,myLink);
      }
    }
);
    cancelButton.setOnClickListener(new View.OnClickListener(){
      public void onClick(      View v){
        finish();
      }
    }
);
  }
 else   if (myAccount == null) {
    textArea.setText(resource.getResource("noAccountInformation").getValue());
    okButton.setText(buttonResource.getResource("refresh").getValue());
    cancelButton.setText(buttonResource.getResource("cancel").getValue());
    okButton.setOnClickListener(new View.OnClickListener(){
      public void onClick(      View v){
        refreshAccountInformation();
      }
    }
);
    cancelButton.setOnClickListener(new View.OnClickListener(){
      public void onClick(      View v){
        finish();
      }
    }
);
  }
 else   if (myCost.compareTo(myAccount) > 0) {
    if (Money.ZERO.equals(myAccount)) {
      textArea.setText(resource.getResource("zeroFunds").getValue().replace("%0",myCost.toString()));
    }
 else {
      textArea.setText(resource.getResource("unsufficientFunds").getValue().replace("%0",myCost.toString()).replace("%1",myAccount.toString()));
    }
    okButton.setText(buttonResource.getResource("pay").getValue());
    cancelButton.setText(buttonResource.getResource("refresh").getValue());
    okButton.setOnClickListener(new View.OnClickListener(){
      public void onClick(      View v){
        TopupMenuActivity.runMenu(BuyBooksActivity.this,myLink,myCost.subtract(myAccount));
      }
    }
);
    cancelButton.setOnClickListener(new View.OnClickListener(){
      public void onClick(      View v){
        refreshAccountInformation();
      }
    }
);
  }
 else {
    okButton.setOnClickListener(new View.OnClickListener(){
      public void onClick(      View v){
        UIUtil.wait("purchaseBook",buyRunnable(),BuyBooksActivity.this);
      }
    }
);
    cancelButton.setOnClickListener(new View.OnClickListener(){
      public void onClick(      View v){
        finish();
      }
    }
);
    if (myBooks.size() > 1) {
      textArea.setText(resource.getResource("confirmSeveralBooks").getValue().replace("%s",String.valueOf(myBooks.size())));
      okButton.setText(buttonResource.getResource("buy").getValue());
      cancelButton.setText(buttonResource.getResource("cancel").getValue());
    }
 else     if (myBooks.get(0).getStatus() == NetworkBookItem.Status.CanBePurchased) {
      textArea.setText(resource.getResource("confirm").getValue().replace("%s",myBooks.get(0).Title));
      okButton.setText(buttonResource.getResource("buy").getValue());
      cancelButton.setText(buttonResource.getResource("cancel").getValue());
    }
 else {
      textArea.setText(resource.getResource("alreadyBought").getValue());
      cancelButton.setText(buttonResource.getResource("ok").getValue());
      okButton.setVisibility(View.GONE);
    }
  }
}
