{
  try {
    final ZLImage image=BookUtil.getCover(DataUtil.fileFromEncodedPath(uri.substring(7)));
    if (image instanceof ZLFileImageProxy) {
      final ZLFileImageProxy proxy=(ZLFileImageProxy)image;
      proxy.synchronize();
      final ZLStreamImage realImage=proxy.getRealImage();
      if (realImage == null) {
        return notFound(uri);
      }
      final InputStream stream=realImage.inputStream();
      if (stream == null) {
        return notFound(uri);
      }
      return new Response(Response.Status.OK,MimeType.IMAGE_PNG.toString(),stream);
    }
 else     if (image instanceof PluginImage) {
      final PluginImage pluginImage=(PluginImage)image;
      if (myService.ImageSynchronizer.synchronizeImmediately(pluginImage)) {
        final Bitmap bitmap=((ZLBitmapImage)pluginImage.getRealImage()).getBitmap();
        final ByteArrayOutputStream os=new ByteArrayOutputStream();
        bitmap.compress(Bitmap.CompressFormat.JPEG,85,os);
        final InputStream is=new ByteArrayInputStream(os.toByteArray());
        return new Response(Response.Status.OK,MimeType.IMAGE_JPEG.toString(),is);
      }
 else {
        return noContent(uri);
      }
    }
 else {
      return notFound(uri);
    }
  }
 catch (  Throwable t) {
    return forbidden(uri,t);
  }
}
