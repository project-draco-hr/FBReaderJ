{
  if (fileName == null) {
    return null;
  }
  String physicalFileName=new ZLFile(fileName).getPhysicalFilePath();
  ZLFile file=new ZLFile(physicalFileName);
  if (checkFile && !file.exists()) {
    return null;
  }
  BookDescription description=(BookDescription)ourDescriptions.get(fileName);
  if (description == null) {
    description=new BookDescription(fileName);
    ourDescriptions.put(fileName,description);
  }
  if (!checkFile || BookDescriptionUtil.checkInfo(file)) {
    BookInfo info=new BookInfo(fileName);
    description.myAuthor=SingleAuthor.create(info.AuthorDisplayNameOption.getValue(),info.AuthorSortKeyOption.getValue());
    description.myTitle=info.TitleOption.getValue();
    description.mySequenceName=info.SequenceNameOption.getValue();
    description.myNumberInSequence=info.NumberInSequenceOption.getValue();
    description.myLanguage=info.LanguageOption.getValue();
    description.myEncoding=info.EncodingOption.getValue();
    if (info.isFull()) {
      return description;
    }
  }
 else {
    if (physicalFileName != fileName) {
      BookDescriptionUtil.resetZipInfo(file);
    }
    BookDescriptionUtil.saveInfo(file);
  }
  ZLFile bookFile=new ZLFile(fileName);
  FormatPlugin plugin=PluginCollection.instance().getPlugin(bookFile,false);
  if ((plugin == null) || !plugin.readDescription(fileName,description)) {
    return null;
  }
  if (description.myTitle.length() == 0) {
    description.myTitle=ZLFile.fileNameToUtf8(bookFile.getName(true));
  }
  Author author=description.myAuthor;
  if (author == null || author.getDisplayName().length() == 0) {
    description.myAuthor=SingleAuthor.create();
  }
  if (description.myEncoding.length() == 0) {
    description.myEncoding="auto";
  }
{
    BookInfo info=new BookInfo(fileName);
    info.AuthorDisplayNameOption.setValue(description.myAuthor.getDisplayName());
    info.AuthorSortKeyOption.setValue(description.myAuthor.getSortKey());
    info.TitleOption.setValue(description.myTitle);
    info.SequenceNameOption.setValue(description.mySequenceName);
    info.NumberInSequenceOption.setValue(description.myNumberInSequence);
    info.LanguageOption.setValue(description.myLanguage);
    info.EncodingOption.setValue(description.myEncoding);
    info.IsSequenceDefinedOption.setValue(true);
  }
  return description;
}
