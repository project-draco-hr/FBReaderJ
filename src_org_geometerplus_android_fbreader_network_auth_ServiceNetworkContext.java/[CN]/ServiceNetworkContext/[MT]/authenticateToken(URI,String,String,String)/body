{
  final String account=getAccountName(uri.getHost(),realm);
  if (account == null) {
    return errorMap("Account name is not specified");
  }
  System.err.println("+++ SERVICE TOKEN AUTH +++");
  try {
    final String authToken=GoogleAuthUtil.getTokenWithNotification(myService,account,String.format("audience:server:client_id:%s",clientId),null);
    final Map<String,String> result=runTokenAuthorization(authUrl,authToken,null);
    if (result.containsKey("user")) {
      return result;
    }
    final String code=GoogleAuthUtil.getTokenWithNotification(myService,account,String.format("oauth2:server:client_id:%s:api_scope:%s",clientId,TextUtils.join(" ",new Object[]{Scopes.DRIVE_FILE,Scopes.PROFILE})),null);
    return runTokenAuthorization(authUrl,authToken,code);
  }
 catch (  UserRecoverableNotifiedException e) {
    return errorMap(e);
  }
catch (  Exception e) {
    return errorMap(e);
  }
 finally {
    System.err.println("--- SERVICE TOKEN AUTH ---");
  }
}
