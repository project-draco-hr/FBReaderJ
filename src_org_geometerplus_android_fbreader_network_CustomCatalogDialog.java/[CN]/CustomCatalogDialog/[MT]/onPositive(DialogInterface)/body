{
  AlertDialog alert=(AlertDialog)dialog;
  myTitle=((TextView)alert.findViewById(R.id.network_catalog_title)).getText().toString().trim();
  myUrl=((TextView)alert.findViewById(R.id.network_catalog_url)).getText().toString().trim();
  mySummary=((TextView)alert.findViewById(R.id.network_catalog_summary)).getText().toString().trim();
  if (myTitle.length() == 0) {
    myTitle=null;
    final String err=myResource.getResource("titleIsEmpty").getValue();
    sendError(true,false,err);
    return;
  }
  if (myUrl.length() == 0) {
    myUrl=null;
    final String err=myResource.getResource("urlIsEmpty").getValue();
    sendError(true,false,err);
    return;
  }
  if (mySummary.length() == 0) {
    mySummary=null;
  }
  Uri uri=Uri.parse(myUrl);
  if (uri.getScheme() == null) {
    myUrl="http://" + myUrl;
    uri=Uri.parse(myUrl);
  }
  String siteName=uri.getHost();
  if (siteName == null) {
    final String err=myResource.getResource("invalidUrl").getValue();
    sendError(true,false,err);
    return;
  }
  if (siteName.startsWith("www.")) {
    siteName=siteName.substring(4);
  }
  if (myLink == null) {
    final OPDSLinkReader reader=new OPDSLinkReader();
    final HashMap<String,String> links=new HashMap<String,String>();
    links.put(INetworkLink.URL_MAIN,myUrl);
    final ICustomNetworkLink link=reader.createCustomLink(ICustomNetworkLink.INVALID_ID,siteName,myTitle,mySummary,null,links);
    myLink=link;
    if (link != null) {
      if (!NetworkLibrary.Instance().addCustomLink(link)) {
        final String err=myResource.getResource("alreadyExists").getValue();
        sendError(true,true,err);
        return;
      }
    }
 else {
      throw new RuntimeException("Unable to create link!!! Impossible!!!");
    }
  }
 else {
    final ICustomNetworkLink link=(ICustomNetworkLink)myLink;
    link.setSiteName(siteName);
    link.setTitle(myTitle);
    link.setSummary(mySummary);
    link.setLink(INetworkLink.URL_MAIN,myUrl);
    link.saveLink();
  }
  sendSuccess(true);
}
