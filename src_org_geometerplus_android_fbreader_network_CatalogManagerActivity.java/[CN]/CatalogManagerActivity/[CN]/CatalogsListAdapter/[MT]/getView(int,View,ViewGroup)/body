{
  final Item item=getItem(position);
  final View view;
  if (convertView != null && item.getClass().equals(convertView.getTag())) {
    view=convertView;
  }
 else {
    view=getLayoutInflater().inflate(item instanceof SectionItem ? R.layout.checkbox_section : R.layout.checkbox_item,null);
    view.setTag(item.getClass());
  }
  if (item instanceof SectionItem) {
    ((TextView)view.findViewById(R.id.title)).setText(((SectionItem)item).Title);
  }
 else {
    final CatalogItem catalogItem=(CatalogItem)item;
    if (myCoverManager == null) {
      view.measure(ViewGroup.LayoutParams.FILL_PARENT,ViewGroup.LayoutParams.WRAP_CONTENT);
      final int coverHeight=view.getMeasuredHeight();
      myCoverManager=new CoverManager(CatalogManagerActivity.this,coverHeight * 15 / 12,coverHeight);
      view.requestLayout();
    }
    final INetworkLink link=catalogItem.Tree.getLink();
    ((TextView)view.findViewById(R.id.title)).setText(link.getTitle());
    ((TextView)view.findViewById(R.id.subtitle)).setText(link.getSummary());
    final ImageView coverView=(ImageView)view.findViewById(R.id.icon);
    if (!myCoverManager.trySetCoverImage(coverView,catalogItem.Tree)) {
      coverView.setImageResource(R.drawable.ic_list_library_books);
    }
    final CheckBox checkBox=(CheckBox)view.findViewById(R.id.check_item);
    checkBox.setChecked(catalogItem.IsChecked);
    checkBox.setOnClickListener(new View.OnClickListener(){
      public void onClick(      View v){
        catalogItem.IsChecked=checkBox.isChecked();
        setResultIds(catalogItem,0);
      }
    }
);
  }
  return view;
}
