{
  String err=doBefore();
  if (err != null) {
    myHandler.sendFinish(err,false);
    return;
  }
  err=doLoading(new NetworkOperationData.OnNewItemListener(){
    private long myUpdateTime;
    private int myItemsNumber;
    public void onNewItem(    NetworkLibraryItem item){
      myHandler.addItem(item);
      ++myItemsNumber;
      final long now=System.currentTimeMillis();
      if (now > myUpdateTime) {
        myHandler.sendUpdateItems();
        myUpdateTime=now + UpdateInterval;
      }
    }
    public boolean requestInterrupt(){
      return isLoadingInterruptRequested() || myItemsNumber >= ItemsLimit;
    }
    public boolean confirmInterrupt(){
      return confirmInterruptLoading() || myItemsNumber >= ItemsLimit;
    }
  }
);
  myHandler.sendUpdateItems();
  myHandler.ensureItemsProcessed();
  myHandler.sendFinish(err,isLoadingInterrupted());
  myHandler.ensureFinishProcessed();
}
