{
  myReader=htmlReader;
  String encoding="UTF-8";
  stream.mark(512);
  final char[] buffer=myBuffer;
  int len;
  for (len=0; len < 512; ++len) {
    char c=(char)stream.read();
    buffer[len]=c;
  }
  StringBuffer description=new StringBuffer(new String(buffer,0,512));
  int index=description.indexOf("encoding");
  if (index <= 0) {
    index=description.indexOf("charset");
  }
  if (index > 0) {
    int startIndex;
    for (startIndex=description.indexOf("=",index) + 1; !Character.isLetter(description.charAt(startIndex)); startIndex++) {
    }
    if (startIndex > 0) {
      int endIndex=Math.min(description.indexOf("\"",startIndex + 1),Math.min(description.indexOf(" ",startIndex + 1),description.indexOf(">",startIndex + 1)));
      if (endIndex > 0) {
        encoding=description.substring(startIndex,endIndex);
      }
    }
  }
  stream.reset();
  InputStreamReader test;
  try {
    test=new InputStreamReader(stream,encoding);
  }
 catch (  UnsupportedEncodingException e) {
    test=new InputStreamReader(stream,"UTF-8");
  }
  myStreamReader=test;
}
