{
  super.onCreate(icicle);
  Thread.setDefaultUncaughtExceptionHandler(new org.geometerplus.zlibrary.ui.android.library.UncaughtExceptionHandler(this));
  setContentView(R.layout.scan_local_network);
  setTitle(myResource.getResource("localCatalogs").getValue());
  final View buttonView=findViewById(R.id.scan_local_network_buttons);
  final ZLResource buttonResource=ZLResource.resource("dialog").getResource("button");
  final Button cancelButton=(Button)buttonView.findViewById(R.id.cancel_button);
  cancelButton.setText(buttonResource.getResource("cancel").getValue());
  cancelButton.setOnClickListener(new View.OnClickListener(){
    public void onClick(    View view){
      finish();
    }
  }
);
  final WifiManager wifiManager=(WifiManager)getSystemService(Context.WIFI_SERVICE);
  final int state=wifiManager.getWifiState();
  if (state != WifiManager.WIFI_STATE_ENABLED && state != WifiManager.WIFI_STATE_ENABLING) {
    setTitle(myResource.getResource("wifiIsTurnedOff").getValue());
    final View listView=findViewById(android.R.id.list);
    final TextView errorView=(TextView)findViewById(R.id.scan_local_network_error);
    listView.setVisibility(View.GONE);
    errorView.setVisibility(View.VISIBLE);
    errorView.setText(myResource.getResource("turnWiFiOn").getValue());
    buttonView.findViewById(R.id.ok_button).setVisibility(View.GONE);
    cancelButton.setText(buttonResource.getResource("ok").getValue());
    myLock=null;
  }
 else {
    final Button rescanButton=(Button)buttonView.findViewById(R.id.ok_button);
    rescanButton.setText(buttonResource.getResource("rescan").getValue());
    rescanButton.setOnClickListener(new View.OnClickListener(){
      public void onClick(      View view){
        scan();
      }
    }
);
    myLock=wifiManager.createMulticastLock("FBReader_lock");
    myLock.setReferenceCounted(true);
    myLock.acquire();
    scan();
  }
}
