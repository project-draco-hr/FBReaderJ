{
  if (myWifi.getWifiState() != WifiManager.WIFI_STATE_ENABLED && myWifi.getWifiState() != WifiManager.WIFI_STATE_ENABLING) {
    showWifiDialog();
  }
  final Runnable scanRunnable=new Runnable(){
    public void run(){
      final ArrayList<ServiceInfoItem> services=new ArrayList<ServiceInfoItem>();
      String errorText;
      try {
        for (        InetAddress address : getLocalIpAddresses()) {
          final JmDNS mcDNS=JmDNS.create(address,"FBReader");
          for (          String type : ourServiceTypes) {
            for (            ServiceInfo info : mcDNS.list(type)) {
              services.add(new ServiceInfoItem(info));
            }
          }
          mcDNS.close();
        }
        errorText=services.isEmpty() ? myResource.getResource("noCatalogsFound").getValue() : null;
      }
 catch (      Exception e) {
        errorText=e.getMessage();
      }
      setup(services,errorText);
    }
  }
;
  UIUtil.wait("scanningLocalNetwork",scanRunnable,this);
}
