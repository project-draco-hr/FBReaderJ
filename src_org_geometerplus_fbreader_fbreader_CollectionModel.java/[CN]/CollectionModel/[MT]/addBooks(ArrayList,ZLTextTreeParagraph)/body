{
  Author author=null;
  ZLTextTreeParagraph authorParagraph=null;
  String currentSeriesName=null;
  ZLTextTreeParagraph seriesParagraph=null;
  final int len=books.size();
  for (int i=0; i < len; ++i) {
    BookDescription description=(BookDescription)books.get(i);
    final Author newAuthor=description.getAuthor();
    if (!newAuthor.equals(author)) {
      author=newAuthor;
      authorParagraph=createParagraph(root);
      insertText(FBTextKind.LIBRARY_AUTHOR_ENTRY,author.getDisplayName());
      currentSeriesName=null;
      seriesParagraph=null;
    }
    final String seriesName=description.getSeriesName();
    if (seriesName.length() == 0) {
      currentSeriesName=null;
      seriesParagraph=null;
    }
 else     if (!seriesName.equals(currentSeriesName)) {
      currentSeriesName=seriesName;
      seriesParagraph=createParagraph(authorParagraph);
      insertText(FBTextKind.LIBRARY_BOOK_ENTRY,seriesName);
    }
    ZLTextTreeParagraph bookParagraph=createParagraph((seriesParagraph == null) ? authorParagraph : seriesParagraph);
    insertText(FBTextKind.LIBRARY_BOOK_ENTRY,description.getTitle());
    insertImage(BookInfoImageId);
    if (myCollection.isBookExternal(description)) {
      insertImage(RemoveBookImageId);
    }
    myParagraphToBook.put(bookParagraph,description);
    ArrayList numbers=(ArrayList)myBookToParagraph.get(description);
    if (numbers == null) {
      numbers=new ArrayList();
      myBookToParagraph.put(description,numbers);
    }
    numbers.add(getParagraphsNumber() - 1);
  }
}
