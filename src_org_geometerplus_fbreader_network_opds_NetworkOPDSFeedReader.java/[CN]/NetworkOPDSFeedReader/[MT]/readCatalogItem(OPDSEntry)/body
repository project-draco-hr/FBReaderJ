{
  final OPDSNetworkLink opdsLink=(OPDSNetworkLink)myData.Link;
  final Map<NetworkItem.UrlType,String> urlMap=new HashMap<NetworkItem.UrlType,String>();
  boolean urlIsAlternate=false;
  String litresRel=null;
  int catalogType=NetworkCatalogItem.FLAGS_DEFAULT;
  for (  ATOMLink link : entry.Links) {
    final String href=ZLNetworkUtil.url(myBaseURL,link.getHref());
    final String type=ZLNetworkUtil.filterMimeType(link.getType());
    final String rel=opdsLink.relation(link.getRel(),type);
    if (MIME_IMAGE_PNG.equals(type) || MIME_IMAGE_JPEG.equals(type)) {
      if (REL_IMAGE_THUMBNAIL.equals(rel) || REL_THUMBNAIL.equals(rel)) {
        urlMap.put(NetworkItem.UrlType.Thumbnail,href);
      }
    }
 else     if (MIME_IMAGE_PNG.equals(type) || MIME_IMAGE_JPEG.equals(type)) {
      if (REL_COVER.equals(rel) || (rel != null && rel.startsWith(REL_IMAGE_PREFIX))) {
        urlMap.put(NetworkItem.UrlType.Image,href);
      }
    }
 else     if (MIME_APP_ATOM.equals(type)) {
      final boolean hasCatalogUrl=urlMap.get(NetworkItem.UrlType.Catalog) != null;
      if (REL_ALTERNATE.equals(rel)) {
        if (!hasCatalogUrl) {
          urlMap.put(NetworkItem.UrlType.Catalog,href);
          urlIsAlternate=true;
        }
      }
 else       if (!hasCatalogUrl || rel == null || REL_SUBSECTION.equals(rel)) {
        urlMap.put(NetworkItem.UrlType.Catalog,href);
        urlIsAlternate=false;
        if (REL_CATALOG_AUTHOR.equals(rel)) {
          catalogType&=~NetworkCatalogItem.FLAG_SHOW_AUTHOR;
        }
 else         if (REL_CATALOG_SERIES.equals(rel)) {
          catalogType&=~NetworkCatalogItem.FLAGS_GROUP;
        }
      }
    }
 else     if (MIME_TEXT_HTML.equals(type)) {
      if (REL_ACQUISITION.equals(rel) || REL_ACQUISITION_OPEN.equals(rel) || REL_ALTERNATE.equals(rel)|| rel == null) {
        urlMap.put(NetworkItem.UrlType.HtmlPage,href);
      }
    }
 else     if (MIME_APP_LITRES.equals(type)) {
      urlMap.put(NetworkItem.UrlType.Catalog,href);
      litresRel=rel;
    }
  }
  if (urlMap.get(NetworkItem.UrlType.Catalog) == null && urlMap.get(NetworkItem.UrlType.HtmlPage) == null) {
    return null;
  }
  if (urlMap.get(NetworkItem.UrlType.Catalog) != null && !urlIsAlternate) {
    urlMap.remove(NetworkItem.UrlType.HtmlPage);
  }
  final String annotation;
  if (entry.Summary != null) {
    annotation=entry.Summary.replace("\n","");
  }
 else   if (entry.Content != null) {
    annotation=entry.Content.replace("\n","");
  }
 else {
    annotation=null;
  }
  if (litresRel != null) {
    if (REL_BOOKSHELF.equals(litresRel)) {
      return new LitResBookshelfItem(opdsLink,entry.Title,annotation,urlMap,opdsLink.getCondition(entry.Id.Uri));
    }
 else     if (REL_RECOMMENDATIONS.equals(litresRel)) {
      return new LitResRecommendationsItem(opdsLink,entry.Title,annotation,urlMap,opdsLink.getCondition(entry.Id.Uri));
    }
 else     if (REL_BASKET.equals(litresRel)) {
      return null;
    }
 else     if (REL_TOPUP.equals(litresRel)) {
      return new TopUpItem(opdsLink,urlMap);
    }
 else {
      return null;
    }
  }
 else {
    return new OPDSCatalogItem(opdsLink,entry.Title,annotation,urlMap,opdsLink.getCondition(entry.Id.Uri),catalogType);
  }
}
