{
  new Thread(new Runnable(){
    public void run(){
synchronized (myBookmarksLock) {
        final Map<String,Bookmark> thisBookBookmarks=new HashMap<String,Bookmark>();
        for (        Bookmark b : myThisBookAdapter.bookmarks()) {
          thisBookBookmarks.put(b.Uid,b);
        }
        final Map<String,Bookmark> allBooksBookmarks=new HashMap<String,Bookmark>();
        for (        Bookmark b : myAllBooksAdapter.bookmarks()) {
          allBooksBookmarks.put(b.Uid,b);
        }
        final Map<String,Bookmark> foundBookmarks=new HashMap<String,Bookmark>();
        final String pattern;
        if (mySearchResultsAdapter != null) {
          for (          Bookmark b : mySearchResultsAdapter.bookmarks()) {
            foundBookmarks.put(b.Uid,b);
          }
          pattern=myBookmarkSearchPatternOption.getValue().toLowerCase();
        }
 else {
          pattern=null;
        }
        for (BookmarkQuery query=new BookmarkQuery(50); ; query=query.next()) {
          final List<Bookmark> loaded=myCollection.bookmarks(query);
          if (loaded.isEmpty()) {
            break;
          }
          for (          Bookmark b : loaded) {
            myAllBooksAdapter.replace(allBooksBookmarks.remove(b.Uid),b);
            if (b.BookId == myBook.getId()) {
              myThisBookAdapter.replace(thisBookBookmarks.remove(b.Uid),b);
            }
            if (pattern != null && MiscUtil.matchesIgnoreCase(b.getText(),pattern)) {
              mySearchResultsAdapter.replace(foundBookmarks.remove(b.Uid),b);
            }
          }
        }
        myAllBooksAdapter.removeAll(allBooksBookmarks.values());
        myThisBookAdapter.removeAll(thisBookBookmarks.values());
        if (mySearchResultsAdapter != null) {
          mySearchResultsAdapter.removeAll(foundBookmarks.values());
        }
      }
    }
  }
).start();
}
