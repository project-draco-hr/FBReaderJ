{
  final ZLPaintContext context=getContext();
  setTextStyle(info.StartStyle);
  final int y=Math.min(context.getY() + info.Height,getTopMargin() + getTextAreaHeight());
  int spaceCounter=info.SpaceCounter;
  int fullCorrection=0;
  final boolean endOfParagraph=info.End.isEndOfParagraph();
  boolean wordOccurred=false;
  boolean changeStyle=true;
  context.moveXTo(getLeftMargin() + info.LeftIndent);
  final int maxWidth=context.getWidth() - getLeftMargin() - getRightMargin();
switch (myTextStyle.alignment()) {
case ZLTextAlignmentType.ALIGN_RIGHT:
{
      context.moveX(maxWidth - myTextStyle.rightIndent() - info.Width);
      break;
    }
case ZLTextAlignmentType.ALIGN_CENTER:
{
    context.moveX((maxWidth - myTextStyle.rightIndent() - info.Width) / 2);
    break;
  }
case ZLTextAlignmentType.ALIGN_JUSTIFY:
{
  if (!endOfParagraph && !(info.End.getElement() == ZLTextElement.AfterParagraph)) {
    fullCorrection=maxWidth - myTextStyle.rightIndent() - info.Width;
  }
  break;
}
case ZLTextAlignmentType.ALIGN_LEFT:
case ZLTextAlignmentType.ALIGN_UNDEFINED:
{
break;
}
}
final ZLTextParagraphCursor paragraph=info.RealStart.getParagraphCursor();
int paragraphNumber=paragraph.getIndex();
final int endWordNumber=info.End.getWordNumber();
int charNumber=info.RealStart.getCharNumber();
for (int wordNumber=info.RealStart.getWordNumber(); wordNumber != endWordNumber; ++wordNumber, charNumber=0) {
final ZLTextElement element=paragraph.getElement(wordNumber);
final int x=context.getX();
final int width=getElementWidth(element,charNumber);
if (element == ZLTextElement.HSpace) {
if (wordOccurred && (spaceCounter > 0)) {
int correction=fullCorrection / spaceCounter;
context.moveX(context.getSpaceWidth() + correction);
fullCorrection-=correction;
wordOccurred=false;
--spaceCounter;
}
}
 else if ((element instanceof ZLTextWord) || (element instanceof ZLTextImageElement)) {
final int height=getElementHeight(element);
final int descent=getElementDescent(element);
final int length=(element instanceof ZLTextWord) ? ((ZLTextWord)element).Length : 0;
myTextElementMap.add(new ZLTextElementArea(paragraphNumber,wordNumber,charNumber,length,false,changeStyle,myTextStyle,element,x,x + width - 1,y - height + 1,y + descent));
changeStyle=false;
wordOccurred=true;
}
 else if (element instanceof ZLTextControlElement) {
applyControl((ZLTextControlElement)element);
changeStyle=true;
}
context.moveX(width);
}
context.moveY(info.Height + info.Descent + info.VSpaceAfter);
}
