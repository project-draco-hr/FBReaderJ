{
  super.onCreateOptionsMenu(menu);
  myOptionsMenuActions.clear();
  myOptionsMenuActions.add(new RootAction(ActionCode.SEARCH,"networkSearch",R.drawable.ic_menu_search){
    @Override public boolean isEnabled(    NetworkTree tree){
      return !searchIsInProgress();
    }
    @Override public void run(    NetworkTree tree){
      onSearchRequested();
    }
  }
);
  myOptionsMenuActions.add(new AddCustomCatalogAction(this));
  myOptionsMenuActions.add(new RootAction(ActionCode.REFRESH,"refreshCatalogsList",R.drawable.ic_menu_refresh){
    @Override public void run(    NetworkTree tree){
      refreshCatalogsList();
    }
  }
);
  myOptionsMenuActions.add(new LanguageFilterAction(this));
  myOptionsMenuActions.add(new CatalogAction(ActionCode.RELOAD_CATALOG,"reload"){
    @Override public boolean isVisible(    NetworkTree tree){
      if (!super.isVisible(tree)) {
        return false;
      }
      final NetworkCatalogItem item=((NetworkCatalogTree)tree).Item;
      if (!(item instanceof NetworkURLCatalogItem)) {
        return false;
      }
      return ((NetworkURLCatalogItem)item).getUrl(UrlInfo.Type.Catalog) != null && ItemsLoadingService.getRunnable(tree) == null;
    }
    @Override public void run(    NetworkTree tree){
      NetworkCatalogActions.doReloadCatalog(NetworkLibraryActivity.this,(NetworkCatalogTree)tree);
    }
  }
);
  myOptionsMenuActions.add(new SignInAction(this));
  myOptionsMenuActions.add(new SignUpAction(this));
  myOptionsMenuActions.add(new SignOutAction(this));
  myOptionsMenuActions.add(new CatalogAction(ActionCode.TOPUP,"topup"){
    @Override public boolean isVisible(    NetworkTree tree){
      if (!super.isVisible(tree)) {
        return false;
      }
      final NetworkCatalogItem item=((NetworkCatalogTree)tree).Item;
      final NetworkAuthenticationManager mgr=item.Link.authenticationManager();
      return mgr != null && mgr.mayBeAuthorised(false) && mgr.currentAccount() != null && TopupMenuActivity.isTopupSupported(item.Link);
    }
    @Override public void run(    NetworkTree tree){
      TopupMenuActivity.runMenu(NetworkLibraryActivity.this,((NetworkCatalogTree)tree).Item.Link,"113");
    }
  }
);
  final NetworkTree tree=(NetworkTree)getCurrentTree();
  for (  Action a : myOptionsMenuActions) {
    final MenuItem item=menu.add(0,a.Code,Menu.NONE,"");
    if (a.IconId != -1) {
      item.setIcon(a.IconId);
    }
  }
  return true;
}
