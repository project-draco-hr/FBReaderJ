{
  final ZLPaintContext context=Context;
  final ZLTextParagraphCursor paragraphCursor=info.ParagraphCursor;
  setTextStyle(info.StartStyle);
  final int y=Math.min(context.getY() + info.Height,getBottomLine());
  int spaceCounter=info.SpaceCounter;
  int fullCorrection=0;
  final boolean endOfParagraph=info.isEndOfParagraph();
  boolean wordOccurred=false;
  boolean changeStyle=true;
  context.moveXTo(getLeftMargin() + info.LeftIndent);
  final int maxWidth=context.getWidth() - getLeftMargin() - getRightMargin();
switch (myTextStyle.getAlignment()) {
case ZLTextAlignmentType.ALIGN_RIGHT:
{
      context.moveX(maxWidth - myTextStyle.getRightIndent() - info.Width);
      break;
    }
case ZLTextAlignmentType.ALIGN_CENTER:
{
    context.moveX((maxWidth - myTextStyle.getRightIndent() - info.Width) / 2);
    break;
  }
case ZLTextAlignmentType.ALIGN_JUSTIFY:
{
  if (!endOfParagraph && (paragraphCursor.getElement(info.EndWordIndex) != ZLTextElement.AfterParagraph)) {
    fullCorrection=maxWidth - myTextStyle.getRightIndent() - info.Width;
  }
  break;
}
case ZLTextAlignmentType.ALIGN_LEFT:
case ZLTextAlignmentType.ALIGN_UNDEFINED:
{
break;
}
}
final ZLTextParagraphCursor paragraph=info.ParagraphCursor;
int paragraphIndex=paragraph.Index;
final int endWordIndex=info.EndWordIndex;
int charIndex=info.RealStartCharIndex;
for (int wordIndex=info.RealStartWordIndex; wordIndex != endWordIndex; ++wordIndex, charIndex=0) {
final ZLTextElement element=paragraph.getElement(wordIndex);
final int x=context.getX();
final int width=getElementWidth(context,element,charIndex);
if (element == ZLTextElement.HSpace) {
if (wordOccurred && (spaceCounter > 0)) {
int correction=fullCorrection / spaceCounter;
context.moveX(context.getSpaceWidth() + correction);
fullCorrection-=correction;
wordOccurred=false;
--spaceCounter;
}
}
 else if ((element instanceof ZLTextWord) || (element instanceof ZLTextImageElement)) {
final int height=getElementHeight(element);
final int descent=getElementDescent(context,element);
final int length=(element instanceof ZLTextWord) ? ((ZLTextWord)element).Length : 0;
myTextElementMap.add(new ZLTextElementArea(paragraphIndex,wordIndex,charIndex,length - charIndex,false,changeStyle,myTextStyle,element,x,x + width - 1,y - height + 1,y + descent));
changeStyle=false;
wordOccurred=true;
}
 else if (element instanceof ZLTextControlElement) {
applyControl((ZLTextControlElement)element);
changeStyle=true;
}
context.moveX(width);
}
if (!endOfParagraph) {
final int len=info.EndCharIndex;
if (len > 0) {
final int wordIndex=info.EndWordIndex;
final ZLTextWord word=(ZLTextWord)paragraph.getElement(wordIndex);
final boolean addHyphenationSign=word.Data[word.Offset + len - 1] != '-';
final int x=context.getX();
final int width=getWordWidth(context,word,0,len,addHyphenationSign);
final int height=getElementHeight(word);
final int descent=context.getDescent();
myTextElementMap.add(new ZLTextElementArea(paragraphIndex,wordIndex,0,len,addHyphenationSign,changeStyle,myTextStyle,word,x,x + width - 1,y - height + 1,y + descent));
}
}
context.moveY(info.Height + info.Descent + info.VSpaceAfter);
}
