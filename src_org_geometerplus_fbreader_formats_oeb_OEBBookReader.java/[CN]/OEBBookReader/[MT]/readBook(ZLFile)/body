{
  long start=System.currentTimeMillis();
  myFilePrefix=MiscUtil.htmlDirectoryPrefix(file);
  myIdToHref.clear();
  myHtmlFileNames.clear();
  myNCXTOCFileName=null;
  myTourTOC.clear();
  myGuideTOC.clear();
  myState=READ_NONE;
  if (!read(file)) {
    return false;
  }
  myModelReader.setMainTextModel();
  myModelReader.pushKind(FBTextKind.REGULAR);
  for (  String name : myHtmlFileNames) {
    final ZLFile xhtmlFile=ZLFile.createFileByPath(myFilePrefix + name);
    final XHTMLReader reader=new XHTMLReader(myModelReader,myFileNumbers);
    final String referenceName=reader.getFileAlias(MiscUtil.archiveEntryName(xhtmlFile.getPath()));
    myModelReader.addHyperlinkLabel(referenceName);
    myTOCLabels.put(referenceName,myModelReader.Model.BookTextModel.getParagraphsNumber());
    reader.readFile(xhtmlFile,referenceName + '#');
    myModelReader.insertEndOfSectionParagraph();
  }
  generateTOC();
  return true;
}
