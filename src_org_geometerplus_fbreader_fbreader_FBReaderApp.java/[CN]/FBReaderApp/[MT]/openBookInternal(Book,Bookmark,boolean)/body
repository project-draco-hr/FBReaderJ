{
  if (!force && Model != null && book.equals(Model.Book)) {
    if (bookmark != null) {
      gotoBookmark(bookmark,false);
    }
    return;
  }
  onViewChanged();
  storePosition();
  BookTextView.setModel(null);
  FootnoteView.setModel(null);
  clearTextCaches();
  Model=null;
  ExternalBook=null;
  System.gc();
  System.gc();
  final FormatPlugin plugin=book.getPluginOrNull();
  if (plugin instanceof ExternalFormatPlugin) {
    ExternalBook=book;
    final Bookmark bm;
    if (bookmark != null) {
      bm=bookmark;
    }
 else {
      ZLTextPosition pos=Collection.getStoredPosition(book.getId());
      if (pos == null) {
        pos=new ZLTextFixedPosition(0,0,0);
      }
      bm=new Bookmark(book,"",pos,pos,"",false);
    }
    myExternalFileOpener.openFile((ExternalFormatPlugin)plugin,book,bm);
    return;
  }
  try {
    Model=BookModel.createModel(book);
    Collection.saveBook(book);
    ZLTextHyphenator.Instance().load(book.getLanguage());
    BookTextView.setModel(Model.getTextModel());
    setBookmarkHighlightings(BookTextView,null);
    BookTextView.gotoPosition(Collection.getStoredPosition(book.getId()));
    if (bookmark == null) {
      setView(BookTextView);
    }
 else {
      gotoBookmark(bookmark,false);
    }
    Collection.addBookToRecentList(book);
    final StringBuilder title=new StringBuilder(book.getTitle());
    if (!book.authors().isEmpty()) {
      boolean first=true;
      for (      Author a : book.authors()) {
        title.append(first ? " (" : ", ");
        title.append(a.DisplayName);
        first=false;
      }
      title.append(")");
    }
    setTitle(title.toString());
  }
 catch (  BookReadingException e) {
    processException(e);
  }
  getViewWidget().reset();
  getViewWidget().repaint();
  try {
    for (    FileEncryptionInfo info : book.getPlugin().readEncryptionInfos(book)) {
      if (info != null && !EncryptionMethod.isSupported(info.Method)) {
        showErrorMessage("unsupportedEncryptionMethod",book.File.getPath());
        break;
      }
    }
  }
 catch (  BookReadingException e) {
  }
}
