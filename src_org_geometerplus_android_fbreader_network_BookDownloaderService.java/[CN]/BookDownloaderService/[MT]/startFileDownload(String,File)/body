{
  final Handler handler=new Handler(){
    public void handleMessage(    Message message){
      final Notification notification=new Notification(android.R.drawable.stat_sys_download_done,"Book has been downloaded",System.currentTimeMillis());
      notification.flags|=Notification.FLAG_AUTO_CANCEL;
      final PendingIntent contentIntent=PendingIntent.getActivity(BookDownloaderService.this,0,getFBReaderIntent(file),0);
      notification.setLatestEventInfo(getApplicationContext(),file.getName(),"Download successful",contentIntent);
      final NotificationManager notificationManager=(NotificationManager)getSystemService(Context.NOTIFICATION_SERVICE);
      notificationManager.notify(FBNotifications.BOOKDOWNLOADER_DOWNLOADSUCCESSFUL,notification);
      stopSelf(myStartIds.poll().intValue());
    }
  }
;
  new Thread(new Runnable(){
    public void run(){
      try {
        final URL url=new URL(uriString);
        final URLConnection connection=url.openConnection();
        final HttpURLConnection httpConnection=(HttpURLConnection)connection;
        final int response=httpConnection.getResponseCode();
        if (response == HttpURLConnection.HTTP_OK) {
          InputStream inStream=httpConnection.getInputStream();
          OutputStream outStream=new FileOutputStream(file);
          final byte[] buffer=new byte[8192];
          int fullSize=0;
          while (true) {
            final int size=inStream.read(buffer);
            if (size <= 0) {
              break;
            }
            outStream.write(buffer,0,size);
          }
          inStream.close();
          outStream.close();
        }
      }
 catch (      MalformedURLException e) {
      }
catch (      IOException e) {
      }
      handler.sendEmptyMessage(0);
    }
  }
).start();
}
