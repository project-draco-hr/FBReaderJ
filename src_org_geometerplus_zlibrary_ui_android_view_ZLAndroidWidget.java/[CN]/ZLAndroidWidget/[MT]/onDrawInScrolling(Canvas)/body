{
  final ZLView view=ZLApplication.Instance().getCurrentView();
  final int w=getWidth();
  final int h=getMainAreaHeight();
  boolean stopScrolling=false;
  if (myScrollingInProgress) {
    myScrollingShift+=(int)myScrollingSpeed;
    if (myScrollingSpeed > 0) {
      if (myScrollingShift >= myScrollingBound) {
        myScrollingShift=myScrollingBound;
        stopScrolling=true;
      }
    }
 else {
      if (myScrollingShift <= myScrollingBound) {
        myScrollingShift=myScrollingBound;
        stopScrolling=true;
      }
    }
    myScrollingSpeed*=1.5;
  }
  final boolean horizontal=(myViewPageToScroll == ZLView.PAGE_RIGHT) || (myViewPageToScroll == ZLView.PAGE_LEFT);
  final int size=horizontal ? w : h;
  int shift=myScrollingShift < 0 ? myScrollingShift + size : myScrollingShift - size;
switch (view.getAnimationType()) {
case shift:
    canvas.drawBitmap(mySecondaryBitmap,horizontal ? shift : 0,horizontal ? 0 : shift,myPaint);
  break;
case slide:
canvas.drawBitmap(mySecondaryBitmap,0,0,myPaint);
break;
case curl:
break;
}
switch (view.getAnimationType()) {
case none:
canvas.drawBitmap(myMainBitmap,0,0,myPaint);
break;
case shift:
case slide:
canvas.drawBitmap(myMainBitmap,horizontal ? myScrollingShift : 0,horizontal ? 0 : myScrollingShift,myPaint);
if (shift < 0) {
shift+=size;
}
if (shift > 0 && shift < size) {
myPaint.setColor(Color.rgb(127,127,127));
if (horizontal) {
canvas.drawLine(shift,0,shift,h + 1,myPaint);
}
 else {
canvas.drawLine(0,shift,w + 1,shift,myPaint);
}
}
break;
case curl:
if (shift <= 0) {
canvas.drawBitmap(mySecondaryBitmap,0,0,myPaint);
}
 else {
myEdgePaint.setColor(ZLAndroidPaintContext.getFillColor());
myEdgePaint.setAntiAlias(true);
myEdgePaint.setStyle(Paint.Style.FILL);
myEdgePaint.setShadowLayer(25,5,5,0x99000000);
final int x=w - shift;
final int y=x * h / w;
final Path bgPath=new Path();
bgPath.moveTo(Math.max(0,w - x * 4 / 3),h);
bgPath.lineTo(w,h);
bgPath.lineTo(w,Math.max(0,h - y * 4 / 3));
canvas.clipPath(bgPath);
canvas.drawBitmap(mySecondaryBitmap,0,0,myPaint);
canvas.restore();
final Path fgPath=new Path();
fgPath.moveTo(Math.max(0,w - x * 4 / 3),h);
fgPath.lineTo(w - x,h - y);
fgPath.lineTo(w,Math.max(0,h - y * 4 / 3));
fgPath.lineTo(w,0);
fgPath.lineTo(0,0);
fgPath.lineTo(0,h);
canvas.clipPath(fgPath);
canvas.drawBitmap(myMainBitmap,0,0,myPaint);
canvas.restore();
final Path path=new Path();
path.moveTo(Math.max(0,w - x * 4 / 3),h);
path.lineTo(w - x,h - y);
path.lineTo(w,Math.max(0,h - y * 4 / 3));
canvas.drawPath(path,myEdgePaint);
break;
}
}
if (stopScrolling) {
if (myScrollingBound != 0) {
Bitmap swap=myMainBitmap;
myMainBitmap=mySecondaryBitmap;
mySecondaryBitmap=swap;
mySecondaryBitmapIsUpToDate=false;
view.onScrollingFinished(myViewPageToScroll);
ZLApplication.Instance().onRepaintFinished();
}
 else {
view.onScrollingFinished(ZLView.PAGE_CENTRAL);
}
setPageToScroll(ZLView.PAGE_CENTRAL);
myScrollingInProgress=false;
myScrollingShift=0;
}
 else {
if (myScrollingInProgress) {
postInvalidate();
}
}
drawFooter(canvas);
}
