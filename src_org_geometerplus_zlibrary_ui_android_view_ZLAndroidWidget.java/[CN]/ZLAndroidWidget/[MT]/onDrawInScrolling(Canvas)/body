{
  final ZLView view=ZLApplication.Instance().getCurrentView();
  final int w=getWidth();
  final int h=getMainAreaHeight();
  boolean doStopScrolling=false;
  if (myScrollingState == ScrollingState.AutoScrollingForward || myScrollingState == ScrollingState.AutoScrollingBackward) {
    if (myScrollHorizontally) {
      myEndX+=(int)myScrollingSpeed;
    }
 else {
      myEndY+=(int)myScrollingSpeed;
    }
    final int bound;
    if (myScrollingState == ScrollingState.AutoScrollingForward) {
      bound=myScrollHorizontally ? getWidth() : getMainAreaHeight();
    }
 else {
      bound=0;
    }
    if (myScrollingSpeed > 0) {
      if (getAnimationProvider().getScrollingShift() >= bound) {
        if (myScrollHorizontally) {
          myEndX=myStartX + bound;
        }
 else {
          myEndY=myStartY + bound;
        }
        doStopScrolling=true;
      }
    }
 else {
      if (getAnimationProvider().getScrollingShift() <= -bound) {
        if (myScrollHorizontally) {
          myEndX=myStartX - bound;
        }
 else {
          myEndY=myStartY - bound;
        }
        doStopScrolling=true;
      }
    }
    myScrollingSpeed*=1.5;
  }
  if (doStopScrolling) {
    if (myScrollingState != ScrollingState.AutoScrollingBackward) {
      Bitmap swap=myMainBitmap;
      myMainBitmap=mySecondaryBitmap;
      mySecondaryBitmap=swap;
      view.onScrollingFinished(myPageToScrollTo);
      ZLApplication.Instance().onRepaintFinished();
    }
 else {
      view.onScrollingFinished(ZLView.PageIndex.current);
    }
    setPageToScrollTo(ZLView.PageIndex.current);
    myScrollingState=ScrollingState.NoScrolling;
    onDrawStatic(canvas);
    return;
  }
  getAnimationProvider().setup(myStartX,myStartY,myEndX,myEndY,myScrollHorizontally,getWidth(),getMainAreaHeight());
  getAnimationProvider().draw(canvas,mySecondaryBitmap,myMainBitmap);
  if (myScrollingState == ScrollingState.AutoScrollingForward || myScrollingState == ScrollingState.AutoScrollingBackward) {
    postInvalidate();
  }
  drawFooter(canvas);
}
