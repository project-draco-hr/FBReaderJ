{
  final Context context=getContext();
  if (context instanceof ZLAndroidActivity) {
    ((ZLAndroidActivity)context).createWakeLock();
  }
 else {
    System.err.println("A surprise: view's context is not a ZLAndroidActivity");
  }
  super.onDraw(canvas);
  final int w=getWidth();
  final int h=getMainAreaHeight();
  if (myMainBitmap != null && (myMainBitmap.getWidth() != w || myMainBitmap.getHeight() != h)) {
    myMainBitmap=null;
    mySecondaryBitmap=null;
    System.gc();
    System.gc();
    System.gc();
  }
  if (myMainBitmap == null) {
    myMainBitmap=Bitmap.createBitmap(w,h,Bitmap.Config.RGB_565);
    mySecondaryBitmap=Bitmap.createBitmap(w,h,Bitmap.Config.RGB_565);
    mySecondaryBitmapIsUpToDate=false;
    drawOnBitmap(myMainBitmap);
  }
  if (getAnimationProvider().inProgress()) {
    onDrawInScrolling(canvas);
  }
 else {
    onDrawStatic(canvas);
    ZLApplication.Instance().onRepaintFinished();
  }
}
