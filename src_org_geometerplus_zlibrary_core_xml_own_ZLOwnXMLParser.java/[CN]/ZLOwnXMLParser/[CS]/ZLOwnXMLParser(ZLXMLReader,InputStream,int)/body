{
  myXMLReader=xmlReader;
  myProcessNamespaces=xmlReader.processNamespaces();
  String encoding="utf-8";
  final char[] buffer=new char[bufferSize];
  myBuffer=buffer;
  int len;
  for (len=0; len < 256; ++len) {
    char c=(char)stream.read();
    if (c == '>') {
      break;
    }
    buffer[len]=c;
  }
  if (len < 256) {
    String xmlDescription=new String(buffer,0,len + 1);
    int index=xmlDescription.indexOf("encoding");
    if (index > 0) {
      int startIndex=xmlDescription.indexOf('"',index);
      if (startIndex > 0) {
        int endIndex=xmlDescription.indexOf('"',startIndex + 1);
        if (endIndex > 0) {
          encoding=xmlDescription.substring(startIndex + 1,endIndex);
        }
      }
    }
  }
  myStreamReader=new InputStreamReader(stream,encoding);
}
