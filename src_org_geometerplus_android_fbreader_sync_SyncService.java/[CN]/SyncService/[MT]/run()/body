{
  if (!mySyncOptions.Enabled.getValue()) {
    return;
  }
  myNetworkContext.reloadCookie();
  myCollection.addListener(this);
  if (ourSynchronizationThread == null) {
    ourSynchronizationThread=new Thread(){
      public void run(){
        final long start=System.currentTimeMillis();
        int count=0;
        final Map<Status,Integer> statusCounts=new HashMap<Status,Integer>();
        try {
          clearHashTables();
          for (BookQuery q=new BookQuery(new Filter.Empty(),20); ; q=q.next()) {
            final List<Book> books=myCollection.books(q);
            if (books.isEmpty()) {
              break;
            }
            for (            Book b : books) {
              addBook(b);
            }
          }
          while (!myQueue.isEmpty()) {
            final Book book=myQueue.remove(0);
            ++count;
            final Status status=uploadBookToServer(book);
            if (status.Label != null) {
              for (              String label : Status.AllLabels) {
                if (status.Label.equals(label)) {
                  book.addLabel(label);
                }
 else {
                  book.removeLabel(label);
                }
              }
              myCollection.saveBook(book);
            }
            final Integer sc=statusCounts.get(status);
            statusCounts.put(status,sc != null ? sc + 1 : 1);
          }
        }
  finally {
          log("SYNCHRONIZATION FINISHED IN " + (System.currentTimeMillis() - start) + "msecs");
          log("TOTAL BOOKS PROCESSED: " + count);
          for (          Status value : Status.values()) {
            log("STATUS " + value + ": "+ statusCounts.get(value));
          }
          ourSynchronizationThread=null;
        }
      }
    }
;
    ourSynchronizationThread.setPriority(Thread.MIN_PRIORITY);
    ourSynchronizationThread.start();
  }
}
