{
  super.onCreate(icicle);
  Thread.setDefaultUncaughtExceptionHandler(new org.geometerplus.zlibrary.ui.android.library.UncaughtExceptionHandler(this));
  AuthenticationActivity.initCredentialsCreator(this);
  setContentView(R.layout.add_custom_catalog);
  myResource=ZLResource.resource("dialog").getResource("CustomCatalogDialog");
  setTitle(myResource.getResource("title").getValue());
  setTextFromResource(R.id.add_custom_catalog_title_label,"catalogTitle");
  setTextFromResource(R.id.add_custom_catalog_url_label,"catalogUrl");
  setTextFromResource(R.id.add_custom_catalog_summary_label,"catalogSummary");
  setTextFromResource(R.id.add_custom_catalog_title_example,"catalogTitleExample");
  setTextFromResource(R.id.add_custom_catalog_url_example,"catalogUrlExample");
  setTextFromResource(R.id.add_custom_catalog_summary_example,"catalogSummaryExample");
  setupButton(R.id.ok_button,"ok",new View.OnClickListener(){
    public void onClick(    View view){
      final InputMethodManager imm=(InputMethodManager)getSystemService(INPUT_METHOD_SERVICE);
      imm.hideSoftInputFromWindow(findViewById(R.id.add_custom_catalog_url).getWindowToken(),0);
      imm.hideSoftInputFromWindow(findViewById(R.id.add_custom_catalog_title).getWindowToken(),0);
      imm.hideSoftInputFromWindow(findViewById(R.id.add_custom_catalog_summary).getWindowToken(),0);
      onOkButton();
    }
  }
);
  setupButton(R.id.cancel_button,"cancel",new View.OnClickListener(){
    public void onClick(    View view){
      finish();
    }
  }
);
  final Button button=(Button)findViewById(R.id.search_button);
  button.setText(myResource.getResource("localNetworkSearch").getValue());
  button.setOnClickListener(new View.OnClickListener(){
    public void onClick(    View view){
      final Intent intent=new Intent();
      intent.setClass(AddCustomCatalogActivity.this,ScanLocalNetworkActivity.class);
      startActivityForResult(intent,1);
    }
  }
);
  Util.initLibrary(this);
  final Intent intent=getIntent();
  myLink=null;
  Uri uri=intent.getData();
  if (uri != null) {
    if ("opds".equals(uri.getScheme())) {
      uri=Uri.parse("http" + uri.toString().substring(4));
    }
    final INetworkLink link=NetworkLibrary.Instance().getLinkByUrl(uri.toString());
    if (link instanceof ICustomNetworkLink) {
      myLink=(ICustomNetworkLink)link;
    }
  }
  myEditNotAdd=intent.getBooleanExtra(EDIT_KEY,false);
  if (myLink != null) {
    setTextById(R.id.add_custom_catalog_url,myLink.getUrl(UrlInfo.Type.Catalog));
    setTextById(R.id.add_custom_catalog_title,myLink.getTitle());
    setTextById(R.id.add_custom_catalog_summary,myLink.getSummary());
    setExtraFieldsVisibility(true);
  }
 else   if (uri != null) {
    if ("opds".equals(uri.getScheme())) {
      uri=Uri.parse("http" + uri.toString().substring(4));
    }
    loadInfoByUri(uri);
  }
 else {
    setExtraFieldsVisibility(false);
  }
}
