{
  if (book == null || book.getId() == -1) {
    return false;
  }
synchronized (myBooksByFile) {
    final Book existing=myBooksByFile.get(book.File);
    if (existing == null) {
      myBooksByFile.put(book.File,book);
      myBooksById.put(book.getId(),book);
      fireBookEvent(BookEvent.Added,book);
      return true;
    }
 else     if (force) {
      final RationalNumber existingProgress=existing.getProgress();
      final RationalNumber bookProgress=book.getProgress();
      existing.updateFrom(book);
      if (existing.save(myDatabase,false)) {
        fireBookEvent(BookEvent.Updated,existing);
        if (!MiscUtil.equals(bookProgress,existingProgress)) {
          fireBookEvent(BookEvent.ProgressUpdated,existing);
        }
        return true;
      }
    }
    return false;
  }
}
