{
  if (bookFile == null) {
    return null;
  }
  final FormatPlugin plugin=PluginCollection.Instance().getPlugin(bookFile);
  if (plugin == null) {
    return null;
  }
  if (!(plugin instanceof BuiltinFormatPlugin) && bookFile != bookFile.getPhysicalFile()) {
    return null;
  }
  try {
    bookFile=plugin.realBookFile(bookFile);
  }
 catch (  BookReadingException e) {
    return null;
  }
  Book book=myBooksByFile.get(bookFile);
  if (book != null) {
    return book;
  }
  final ZLFile otherFile=myDuplicateResolver.findDuplicate(bookFile);
  if (otherFile != null) {
    book=myBooksByFile.get(otherFile);
    if (book != null) {
      return book;
    }
  }
  final ZLPhysicalFile physicalFile=bookFile.getPhysicalFile();
  if (physicalFile != null && !physicalFile.exists()) {
    return null;
  }
  final FileInfoSet fileInfos=new FileInfoSet(myDatabase,bookFile);
  book=myDatabase.loadBookByFile(fileInfos.getId(bookFile),bookFile);
  if (book != null) {
    book.loadLists(myDatabase);
  }
  if (book != null && fileInfos.check(physicalFile,physicalFile != bookFile)) {
    saveBook(book);
    return book;
  }
  fileInfos.save();
  try {
    if (book == null) {
      book=new Book(bookFile);
    }
 else {
      book.readMetainfo();
    }
  }
 catch (  BookReadingException e) {
    return null;
  }
  saveBook(book);
  return book;
}
