{
  super.onCreate(icicle);
  requestWindowFeature(Window.FEATURE_NO_TITLE);
  DatabaseInstance=SQLiteBooksDatabase.Instance();
  if (DatabaseInstance == null) {
    DatabaseInstance=new SQLiteBooksDatabase(this,"LIBRARY");
  }
  if (LibraryInstance == null) {
    LibraryInstance=new Library();
    startService(new Intent(getApplicationContext(),InitializationService.class));
  }
  myItems=new LinkedList<FBTree>();
  myItems.add(new TopLevelTree(myResource.getResource(PATH_FAVORITES),R.drawable.ic_list_library_favorites,new OpenTreeRunnable(LibraryInstance,new StartTreeActivityRunnable(PATH_FAVORITES,null){
    public void run(){
      if (LibraryInstance.favorites().hasChildren()) {
        super.run();
      }
 else {
        UIUtil.showErrorMessage(LibraryTopLevelActivity.this,"noFavorites");
      }
    }
  }
)));
  myItems.add(new TopLevelTree(myResource.getResource(PATH_RECENT),R.drawable.ic_list_library_recent,new OpenTreeRunnable(LibraryInstance,PATH_RECENT)));
  myItems.add(new TopLevelTree(myResource.getResource(PATH_BY_AUTHOR),R.drawable.ic_list_library_authors,new OpenTreeRunnable(LibraryInstance,PATH_BY_AUTHOR)));
  myItems.add(new TopLevelTree(myResource.getResource(PATH_BY_TITLE),R.drawable.ic_list_library_books,new OpenTreeRunnable(LibraryInstance,PATH_BY_TITLE)));
  myItems.add(new TopLevelTree(myResource.getResource(PATH_BY_TAG),R.drawable.ic_list_library_tags,new OpenTreeRunnable(LibraryInstance,PATH_BY_TAG)));
  myItems.add(new TopLevelTree(myResource.getResource("fileTree"),R.drawable.ic_list_library_folder,new Runnable(){
    public void run(){
      startActivity(new Intent(LibraryTopLevelActivity.this,FileManager.class).putExtra(SELECTED_BOOK_PATH_KEY,mySelectedBookPath));
    }
  }
));
  setListAdapter(new LibraryAdapter(myItems));
  onNewIntent(getIntent());
}
